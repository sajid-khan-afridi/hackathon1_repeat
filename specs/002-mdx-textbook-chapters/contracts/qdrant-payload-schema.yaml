# Qdrant Vector Database Payload Schema
# Feature: 002-mdx-textbook-chapters
# Date: 2025-12-12
# Used by: content-indexer skill, rag-pipeline skill

$schema: "http://json-schema.org/draft-07/schema#"
title: QdrantChunkPayload
description: Payload schema for textbook content chunks in Qdrant vector database
type: object

# Collection configuration
collection:
  name: robotics_textbook_chapters
  vector_config:
    size: 384
    distance: Cosine
  hnsw_config:
    m: 16
    ef_construct: 100
  payload_indexes:
    - field: chapter_id
      type: keyword
    - field: tags
      type: keyword
    - field: difficulty_level
      type: keyword
    - field: module
      type: keyword
    - field: ros_version
      type: keyword

# Chunk payload schema
required:
  - chapter_id
  - chapter_title
  - section_id
  - section_title
  - content
  - tags
  - difficulty_level
  - ros_version
  - module

properties:
  chapter_id:
    type: string
    description: Unique chapter identifier
    pattern: "^ch[0-9]{2}$"
    examples:
      - "ch01"
      - "ch07"

  chapter_title:
    type: string
    description: Full chapter title for display
    minLength: 10
    maxLength: 100
    examples:
      - "ROS 2 Nodes & Lifecycle"

  section_id:
    type: string
    description: Section identifier within chapter
    pattern: "^sec-[0-9]{2}-[0-9]-[0-9]$"
    examples:
      - "sec-01-1-2"
      - "sec-07-3-1"

  section_title:
    type: string
    description: Section heading for display
    minLength: 5
    maxLength: 100
    examples:
      - "1.2 Creating Your First Publisher"

  content:
    type: string
    description: Full text content of the section (used for embedding generation)
    minLength: 100
    maxLength: 10000
    examples:
      - "Let's create a simple publisher that sends a 'Hello World' message every second..."

  tags:
    type: array
    description: Content tags for filtering
    minItems: 1
    maxItems: 10
    items:
      type: string
      pattern: "^[a-z0-9-]+$"
    examples:
      - ["ros2", "publisher", "rclpy"]

  difficulty_level:
    type: string
    description: Section difficulty level
    enum:
      - beginner
      - intermediate
      - advanced

  ros_version:
    type: string
    description: Target ROS 2 version
    pattern: "^(humble|iron|jazzy)$"
    examples:
      - "humble"

  module:
    type: string
    description: Curriculum module grouping
    enum:
      - ros2-fundamentals
      - isaac-sim
      - applications

  # Optional metadata
  learning_objectives:
    type: array
    description: Relevant learning objectives from parent chapter
    items:
      type: string
    examples:
      - ["Create ROS 2 nodes", "Understand lifecycle states"]

  code_languages:
    type: array
    description: Programming languages used in code examples within this section
    items:
      type: string
      enum:
        - python
        - cpp
        - bash
        - yaml
    examples:
      - ["python", "cpp"]

  has_exercises:
    type: boolean
    description: Whether this section contains exercises
    default: false

  estimated_reading_time:
    type: integer
    description: Estimated reading time for this section in minutes
    minimum: 1
    maximum: 15
    examples:
      - 5

additionalProperties: false

# Chunk ID generation pattern
id_pattern:
  format: "{chapter_id}-{section_id}-{hash}"
  description: Unique chunk ID combining chapter, section, and content hash
  examples:
    - "ch01-sec-01-1-2-a1b2c3"
    - "ch07-sec-07-3-1-d4e5f6"

# Embedding model configuration
embedding:
  model: "sentence-transformers/all-MiniLM-L6-v2"
  dimensions: 384
  max_tokens: 512
  overlap_tokens: 50
  description: Section content is chunked if exceeds max_tokens

# Search configuration
search:
  default_limit: 10
  score_threshold: 0.5
  description: Default search parameters for RAG pipeline

# Example complete payload
examples:
  - chapter_id: "ch01"
    chapter_title: "ROS 2 Nodes & Lifecycle"
    section_id: "sec-01-1-2"
    section_title: "1.2 Creating Your First Publisher"
    content: |
      Let's create a simple publisher that sends a "Hello World" message every second.

      ### Python Implementation

      ```python
      import rclpy
      from rclpy.node import Node
      from std_msgs.msg import String

      class SimplePublisher(Node):
          def __init__(self):
              super().__init__('simple_publisher')
              self.publisher_ = self.create_publisher(String, 'hello_topic', 10)
              self.timer = self.create_timer(1.0, self.timer_callback)

          def timer_callback(self):
              msg = String()
              msg.data = 'Hello World!'
              self.publisher_.publish(msg)
      ```

      The publisher creates a node named 'simple_publisher' and publishes String messages
      to the 'hello_topic' topic at 1 Hz frequency.
    tags:
      - ros2
      - publisher
      - rclpy
      - node
      - tutorial
    difficulty_level: beginner
    ros_version: humble
    module: ros2-fundamentals
    learning_objectives:
      - "Create ROS 2 nodes using rclpy"
      - "Implement publisher-subscriber patterns"
    code_languages:
      - python
    has_exercises: false
    estimated_reading_time: 5

# Query examples for testing
test_queries:
  - id: "q01"
    query: "how to create ROS 2 publisher"
    expected_top_result: "ch01-sec-01-1-2"
    relevance_grade: 3

  - id: "q02"
    query: "ROS 2 node lifecycle states"
    expected_top_result: "ch01-sec-01-1-3"
    relevance_grade: 3
